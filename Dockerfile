FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGhlbGxvLXdvcmxkLWRiLWFwYgpkZXNjcmlwdGlvbjogQSBzYW1w\
bGUgQVBCIHdoaWNoIGRlcGxveXMgSGVsbG8gV29ybGQgRGF0YWJhc2UKYmluZGFibGU6IFRydWUK\
YXN5bmM6IG9wdGlvbmFsCm1ldGFkYXRhOgogIGRpc3BsYXlOYW1lOiBIZWxsbyBXb3JsZCBEYXRh\
YmFzZSAoQVBCKQogIGRlcGVuZGVuY2llczogWydkb2NrZXIuaW8vY2VudG9zL3Bvc3RncmVzcWwt\
OTUtY2VudG9zNyddCiAgcHJvdmlkZXJEaXNwbGF5TmFtZTogIlJlZCBIYXQsIEluYy4iCnBsYW5z\
OgogIC0gbmFtZTogZGVmYXVsdAogICAgZGVzY3JpcHRpb246IEEgc2FtcGxlIEFQQiB3aGljaCBk\
ZXBsb3lzIEhlbGxvIFdvcmxkIERhdGFiYXNlCiAgICBmcmVlOiBUcnVlCiAgICBtZXRhZGF0YToK\
ICAgICAgZGlzcGxheU5hbWU6IERlZmF1bHQKICAgICAgbG9uZ0Rlc2NyaXB0aW9uOiBUaGlzIHBs\
YW4gZGVwbG95cyBhIFBvc3RncmVzIERhdGFiYXNlIHRoZSBIZWxsbyBXb3JsZCBhcHBsaWNhdGlv\
biBjYW4gY29ubmVjdCB0bwogICAgICBjb3N0OiAkMC4wMAogICAgcGFyYW1ldGVyczoKICAgICAg\
LSBuYW1lOiBwb3N0Z3Jlc3FsX2FkbWluX3Bhc3N3b3JkCiAgICAgICAgdGl0bGU6IFBvc3RncmVT\
UUwgQWRtaW4gUGFzc3dvcmQKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAgICByZXF1aXJlZDog\
dHJ1ZQogICAgYmluZF9wYXJhbWV0ZXJzOgogICAgICAtIG5hbWU6IHBvc3RncmVzcWxfZGJfbmFt\
ZQogICAgICAgIHRpdGxlOiBQb3N0Z3JlU1FMIERhdGFiYXNlIE5hbWUKICAgICAgICB0eXBlOiBz\
dHJpbmcKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6IGhlbGxvLXdvcmxk\
CiAgICAgIC0gbmFtZTogcG9zdGdyZXNxbF91c2VyCiAgICAgICAgdGl0bGU6IFBvc3RncmVTUUwg\
VXNlcgogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAg\
ZGVmYXVsdDogaGVsbG8td29ybGQtdXNlcgogICAgICAtIG5hbWU6IHBvc3RncmVzcWxfcGFzc3dv\
cmQKICAgICAgICB0aXRsZTogUG9zdGdyZVNRTCBQYXNzd29yZAogICAgICAgIHR5cGU6IHN0cmlu\
ZwogICAgICAgIHJlcXVpcmVkOiB0cnVlCg=="

RUN yum -y install postgresql-libs python-psycopg2 && yum clean all
COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb}
USER apb
